<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chattify IT - Turn Your ChatGPT Chatbots Into Paid Subscriptions</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background-color: #fafafa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e5e5;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a1a1a;
        }

        .logo .highlight {
            color: #00c896;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: #666;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .nav-link:hover {
            color: #1a1a1a;
        }

        .btn {
            background: #00c896;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #00b085;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: transparent;
            color: #00c896;
            border: 2px solid #00c896;
        }

        .btn-secondary:hover {
            background: #00c896;
            color: white;
        }

        /* Landing Page */
        .landing {
            background: white;
            padding: 4rem 0;
        }

        .hero {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            margin-bottom: 4rem;
        }

        .hero-content h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .hero-content .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .value-props {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .value-prop {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            flex: 1;
        }

        .value-prop .number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00c896;
        }

        .signup-form {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid #e5e5e5;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #00c896;
            box-shadow: 0 0 0 3px rgba(0, 200, 150, 0.1);
        }

        /* App Layout */
        .app-layout {
            display: none;
            min-height: 100vh;
        }

        .app-layout.active {
            display: flex;
        }

        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e5e5e5;
            padding: 2rem 0;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar-nav a {
            display: block;
            padding: 0.75rem 2rem;
            color: #666;
            text-decoration: none;
            transition: all 0.2s;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background: #f8f9fa;
            color: #00c896;
            border-right: 3px solid #00c896;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            background: #fafafa;
        }

        .page {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e5e5;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #666;
        }

        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e5e5;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status.active {
            background: #d4edda;
            color: #155724;
        }

        .status.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #00c896;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        /* Loading and Error States */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .hero-content h1 {
                font-size: 2rem;
            }

            .value-props {
                flex-direction: column;
            }

            .app-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .main-content {
                order: 1;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Paywall Details Styles */
        .paywall-info {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .paywall-info h3 {
            color: #00c896;
            margin-bottom: 1rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-item {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e5e5e5;
        }

        .info-label {
            font-weight: 600;
            color: #666;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 1rem;
            color: #1a1a1a;
        }

        .paywall-url {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e5e5e5;
            font-family: monospace;
            word-break: break-all;
            margin-bottom: 1rem;
        }

        .copy-btn {
            background: #00c896;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            margin-left: 0.5rem;
        }

        .copy-btn:hover {
            background: #00b085;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e5e5;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00c896;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.875rem;
        }

        /* Paywall Instructions Styles */
        .paywall-instructions {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 8px;
            margin-top: 2rem;
        }

        .instruction-step {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e5e5e5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .step-number {
            background: #00c896;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .step-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .step-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .code-block {
            background: #1a1a1a;
            color: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            overflow-x: auto;
            position: relative;
            margin-bottom: 1rem;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }

        .code-label {
            color: #00c896;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .code-copy-btn {
            background: #00c896;
            color: white;
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .code-copy-btn:hover {
            background: #00b085;
        }

        .code-copy-btn.copied {
            background: #28a745;
        }

        .code-content {
            white-space: pre-wrap;
            word-break: break-word;
        }

        .instruction-note {
            background: #e8f5e8;
            border-left: 4px solid #00c896;
            padding: 1rem;
            border-radius: 0 4px 4px 0;
            margin-top: 1rem;
        }

        .instruction-note h4 {
            color: #155724;
            margin: 0 0 0.5rem 0;
            font-size: 0.875rem;
        }

        .instruction-note p {
            color: #155724;
            margin: 0;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav container">
            <div class="logo">
                Chattify <span class="highlight">IT</span>
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link" id="loginBtn">Log in</a>
                <a href="#" class="btn" id="getStartedBtn">Get started</a>
                <a href="#" class="nav-link hidden" id="logoutBtn">Logout</a>
            </div>
        </nav>
    </header>

    <!-- Landing Page -->
    <main class="landing" id="landingPage">
        <div class="container">
            <section class="hero">
                <div class="hero-content">
                    <h1>Turn Your ChatGPT Chatbots Into Paid Subscriptions</h1>
                    <p class="subtitle">
                        Connect your ChatGPT chatbots to Chattify IT's paywall platform and transform them into subscription businesses. Finally get paid for the knowledge you've spent years building.
                    </p>
                    
                    <div class="value-props">
                        <div class="value-prop">
                            <div class="number">$19.99</div>
                            <div>Monthly for unlimited paywalls</div>
                        </div>
                        <div class="value-prop">
                            <div class="number">70%</div>
                            <div>Revenue share to you</div>
                        </div>
                        <div class="value-prop">
                            <div class="number">30 days</div>
                            <div>Payout frequency</div>
                        </div>
                    </div>
                </div>

                <div class="signup-form">
                    <h3 style="margin-bottom: 1rem;">Get Started Today</h3>
                    <form id="signupForm">
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" name="password" required minlength="6">
                        </div>
                        <button type="submit" class="btn" style="width: 100%;">
                            Create Account - Start Free
                        </button>
                    </form>
                    
                    <div style="text-align: center; margin-top: 1rem; color: #666;">
                        Already have an account? <a href="#" id="showLoginForm" style="color: #00c896;">Log in</a>
                    </div>

                    <!-- Login Form (Hidden by default) -->
                    <form id="loginForm" class="hidden">
                        <div class="form-group">
                            <label for="loginEmail">Email Address</label>
                            <input type="email" id="loginEmail" name="loginEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" name="loginPassword" required>
                        </div>
                        <button type="submit" class="btn" style="width: 100%;">
                            Log In
                        </button>
                    </form>
                    
                    <div id="loginToggle" class="hidden" style="text-align: center; margin-top: 1rem; color: #666;">
                        Need an account? <a href="#" id="showSignupForm" style="color: #00c896;">Sign up</a>
                    </div>

                    <div id="authError" class="error hidden"></div>
                    <div id="authSuccess" class="success hidden"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- App Layout -->
    <div class="app-layout" id="appLayout">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <li><a href="#" class="nav-item active" data-page="profile">Account Profile</a></li>
                <li><a href="#" class="nav-item" data-page="dashboard">Paywall Dashboard</a></li>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Account Profile Page -->
            <div class="page active" id="profilePage">
                <div class="page-header">
                    <h1 class="page-title">Account Profile</h1>
                    <p class="page-subtitle">Set up your business information and payout preferences</p>
                </div>

                <form id="profileForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="businessName">Business Name *</label>
                            <input type="text" id="businessName" name="businessName" required>
                        </div>
                        <div class="form-group">
                            <label for="contactName">Contact Name *</label>
                            <input type="text" id="contactName" name="contactName" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="businessAddress">Business Address *</label>
                        <textarea class="textarea" id="businessAddress" name="businessAddress" required placeholder="Enter your complete business address"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="payoutEmail">PayPal Email for Payouts (Optional)</label>
                        <input type="email" id="payoutEmail" name="payoutEmail" placeholder="Add this anytime before your first payout">
                        <small style="color: #666; margin-top: 0.5rem; display: block;">
                            You can add your payout information later, but it's required before receiving your first payment.
                        </small>
                    </div>

                    <button type="submit" class="btn">Save Profile</button>
                </form>

                <div id="profileError" class="error hidden"></div>
                <div id="profileSuccess" class="success hidden"></div>
            </div>

            <!-- Paywall Dashboard -->
            <div class="page" id="dashboardPage">
                <div class="page-header">
                    <h1 class="page-title">Paywall Dashboard</h1>
                    <p class="page-subtitle">Manage your ChatGPT paywall subscriptions</p>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPaywalls">0</div>
                        <div class="stat-label">Total Paywalls</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activePaywalls">0</div>
                        <div class="stat-label">Active Paywalls</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">$19.99</div>
                        <div class="stat-label">Monthly Platform Fee</div>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2>Your Paywalls</h2>
                    <button class="btn" id="createPaywallBtn">Create New Paywall</button>
                </div>

                <div id="paywallsTable">
                    <div class="loading">Loading your paywalls...</div>
                </div>
            </div>

            <!-- Create Paywall Page -->
            <div class="page" id="createPage">
                <div class="page-header">
                    <h1 class="page-title">Create New Paywall</h1>
                    <p class="page-subtitle">Set up a paywall for your ChatGPT chatbot</p>
                </div>

                <form id="createPaywallForm">
                    <div class="form-group">
                        <label for="paywallName">Paywall Name *</label>
                        <input type="text" id="paywallName" name="paywallName" required placeholder="e.g., My Marketing Assistant GPT">
                    </div>

                    <div class="form-group">
                        <label for="paywallDescription">Description *</label>
                        <textarea class="textarea" id="paywallDescription" name="paywallDescription" required placeholder="Describe what your ChatGPT chatbot does and the value it provides"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="monthlyPrice">Monthly Price (USD) *</label>
                            <input type="number" id="monthlyPrice" name="monthlyPrice" required min="1" step="0.01" placeholder="29.99">
                        </div>
                        <div class="form-group">
                            <label for="freeTrialDays">Free Trial Duration (Days)</label>
                            <input type="number" id="freeTrialDays" name="freeTrialDays" min="0" max="30" placeholder="7">
                        </div>
                    </div>

                    <button type="submit" class="btn">Create Paywall</button>
                    <button type="button" class="btn btn-secondary" id="cancelCreate" style="margin-left: 1rem;">Cancel</button>
                </form>

                <div id="createError" class="error hidden"></div>
                <div id="createSuccess" class="success hidden"></div>
            </div>


            <!-- Paywall Details -->
            <div class="page" id="paywallDetailsPage">
                <div class="page-header">
                    <h1 class="page-title">Paywall Details</h1>
                    <p class="page-subtitle">View and manage your paywall</p>
                </div>

                <div id="paywallDetailsContent">
                    <div class="loading">Loading paywall details...</div>
                </div>

                <div id="paywallDetailsError" class="error hidden"></div>
                <div id="paywallDetailsSuccess" class="success hidden"></div>
            </div>

            <!-- Installation Instructions -->
            <div class="page" id="instructionsPage">
                <div class="page-header">
                    <h1 class="page-title">Installation Instructions</h1>
                    <p class="page-subtitle">Connect your paywall to your existing ChatGPT chatbot</p>
                </div>

                <div style="background: #f8f9fa; padding: 2rem; border-radius: 8px; margin-bottom: 2rem;">
                    <h3 style="color: #00c896; margin-bottom: 1rem;">Step-by-Step Integration Guide</h3>
                    
                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Step 1: Get Your Paywall Link</h4>
                        <p style="margin-bottom: 1rem;">After creating a paywall, you'll receive a unique paywall URL that looks like:</p>
                        <code style="background: white; padding: 0.5rem; border-radius: 4px; display: block;">
                            https://chattifyit.com/paywall/[your-paywall-id]
                        </code>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Step 2: Update Your ChatGPT Instructions</h4>
                        <p style="margin-bottom: 1rem;">Add this text to the beginning of your ChatGPT's custom instructions:</p>
                        <div style="background: white; padding: 1rem; border-radius: 4px; border-left: 4px solid #00c896;">
                            <p><strong>Important:</strong> Before providing any responses, users must first subscribe at [YOUR PAYWALL URL]. If a user hasn't subscribed, direct them to visit the subscription link first.</p>
                        </div>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Step 3: Test Your Integration</h4>
                        <ol style="margin-left: 2rem;">
                            <li style="margin-bottom: 0.5rem;">Visit your ChatGPT in a private/incognito browser window</li>
                            <li style="margin-bottom: 0.5rem;">Try to use the chatbot without subscribing first</li>
                            <li style="margin-bottom: 0.5rem;">Verify it directs you to your paywall</li>
                            <li style="margin-bottom: 0.5rem;">Complete a test subscription to ensure the flow works</li>
                        </ol>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Step 4: Promote Your Paywall</h4>
                        <ul style="margin-left: 2rem;">
                            <li style="margin-bottom: 0.5rem;">Share your paywall link on social media</li>
                            <li style="margin-bottom: 0.5rem;">Add it to your website or bio links</li>
                            <li style="margin-bottom: 0.5rem;">Include it in email signatures</li>
                            <li style="margin-bottom: 0.5rem;">Mention it in relevant communities</li>
                        </ul>
                    </div>

                    <div style="background: #e8f5e8; padding: 1rem; border-radius: 4px; border-left: 4px solid #00c896;">
                        <h4 style="color: #155724; margin-bottom: 0.5rem;">💡 Pro Tip</h4>
                        <p style="color: #155724; margin: 0;">Create a compelling description and set an appropriate price point. Users are willing to pay for valuable, specialized knowledge that saves them time!</p>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button class="btn" id="backToDashboard">Back to Dashboard</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Supabase configuration
        // const SUPABASE_URL = 'https://tvmwchdjjhfuyshofylo.supabase.co'; // Replace with your actual Supabase URL
        // const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR2bXdjaGRqamhmdXlzaG9meWxvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2MDg5NDIsImV4cCI6MjA3NDE4NDk0Mn0.Gzompa2tlKeLrVC5Z6a1oUjU_5it52VUyrmfsWwpoO4'; // Replace with your actual anon key
        const SUPABASE_URL = 'https://jkxgaoogdzwduebskkkf.supabase.co'; // Replace with your actual Supabase URL
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpreGdhb29nZHp3ZHVlYnNra2tmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3MTAxNTAsImV4cCI6MjA3NDI4NjE1MH0.OSTwaWv7TDbfmNLXjTiMSDGbHOejPmOwOujEiyDBs4E'; // Replace with your actual anon key


        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Global state
        let currentUser = null;
        let currentPage = 'profile';
        let currentPaywallId = null;

        // DOM elements
        const landingPage = document.getElementById('landingPage');
        const appLayout = document.getElementById('appLayout');
        const signupForm = document.getElementById('signupForm');
        const loginForm = document.getElementById('loginForm');
        const profileForm = document.getElementById('profileForm');
        const createPaywallForm = document.getElementById('createPaywallForm');

        // Utilities
        class ApiClient {
            constructor(baseUrl) {
                this.baseUrl = baseUrl;
            }

            async get(path) {
                try {
                    const response = await fetch(`${this.baseUrl}${path}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    if (!response.ok) {
                        return { data: null, error: new Error(`HTTP error! status: ${response.status}`) };
                    }
                    const result = await response.json();
                    return { data: result, error: null };
                } catch (err) {
                    return { data: null, error: err };
                }
            }

            async post(path, payload = {}) {
                try {
                    const response = await fetch(`${this.baseUrl}${path}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        return { data: null, error: new Error(`HTTP error! status: ${response.status}`) };
                    }
                    const result = await response.json();
                    return { data: result, error: null };
                } catch (err) {
                    return { data: null, error: err };
                }
            }
        }
        const api = new ApiClient('https://jkxgaoogdzwduebskkkf.supabase.co/functions/v1/api');

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            // Check if user is already logged in
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                showApp();
                await loadUserProfile();
                await loadPaywalls();
            }

            setupEventListeners();
        });

        // Event listeners
        function setupEventListeners() {
            // Auth forms
            signupForm.addEventListener('submit', handleSignup);
            loginForm.addEventListener('submit', handleLogin);
            
            // Form toggles
            document.getElementById('showLoginForm').addEventListener('click', showLoginForm);
            document.getElementById('showSignupForm').addEventListener('click', showSignupForm);
            document.getElementById('loginBtn').addEventListener('click', showLoginForm);
            document.getElementById('getStartedBtn').addEventListener('click', () => {
                document.getElementById('signupForm').scrollIntoView({ behavior: 'smooth' });
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = e.target.dataset.page;
                    navigateToPage(page);
                });
            });

            // Forms
            profileForm.addEventListener('submit', handleProfileSubmit);
            createPaywallForm.addEventListener('submit', handleCreatePaywall);

            // Buttons
            document.getElementById('createPaywallBtn').addEventListener('click', () => navigateToPage('create'));
            document.getElementById('cancelCreate').addEventListener('click', () => navigateToPage('dashboard'));
            document.getElementById('backToDashboard').addEventListener('click', () => navigateToPage('dashboard'));

            // Paywall links (delegated event listener)
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('paywall-link')) {
                    e.preventDefault();
                    const paywallId = e.target.dataset.paywallId;
                    showPaywallDetails(paywallId);
                }
            });
        }

        // Authentication functions
        async function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const { data, error } = await supabase.auth.signUp({ email, password });
                
                if (error) throw error;

                if (data.user) {
                    let data2, error;
                    ({ data: data2, error } = await api.post(`/account/create`, { email, uuid: data.user.id }));

                    if (error) throw error;

                    showSuccess('Account created successfully! Please check your email to verify your account.');
                    currentUser = data.user;
                    showApp();
                }
            } catch (error) {
                showError(error.message);
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                
                if (error) throw error;

                currentUser = data.user;
                showApp();
                await loadUserProfile();
                await loadPaywalls();
            } catch (error) {
                showError(error.message);
            }
        }

        async function handleLogout() {
            try {
                await supabase.auth.signOut();
                currentUser = null;
                showLanding();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Profile functions
        async function handleProfileSubmit(e) {
            e.preventDefault();
            
            const profileData = {
                user_id: currentUser.id,
                business_name: document.getElementById('businessName').value,
                contact_name: document.getElementById('contactName').value,
                business_address: document.getElementById('businessAddress').value,
                payout_email: document.getElementById('payoutEmail').value || null
            };

            try {
                const { error } = await supabase
                    .from('accounts')
                    .upsert(profileData);

                if (error) throw error;

                showSuccessMessage('profileSuccess', 'Profile saved successfully!');
            } catch (error) {
                showErrorMessage('profileError', error.message);
            }
        }

        async function loadUserProfile() {
            try {
                const { data, error } = await supabase
                    .from('accounts')
                    .select('*')
                    .eq('uuid', currentUser.id)
                    .single();

                if (error && error.code !== 'PGRST116') throw error;

                if (data) {
                    document.getElementById('businessName').value = data.company_name || '';
                    document.getElementById('contactName').value = data.contact_name || '';
                    document.getElementById('businessAddress').value = data.business_address || '';
                    document.getElementById('payoutEmail').value = data.payout_email || '';
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // Paywall functions
        async function handleCreatePaywall(e) {
            e.preventDefault();
            
            const paywallData = {
                name: document.getElementById('paywallName').value,
                description: document.getElementById('paywallDescription').value,
                price: parseFloat(document.getElementById('monthlyPrice').value),
                trial: parseInt(document.getElementById('freeTrialDays').value) || 0,
                pricing_model: "recurring",
                currency: "USD",
                interval: "monthly",
            };

            try {
                let data, error;
                ({ data, error } = await api.post(`/account/${currentUser.id}/paywall/create`, paywallData));

                if (error) throw error;

                showSuccessMessage('createSuccess', 'Paywall created successfully!');
                createPaywallForm.reset();
                
                // Redirect to dashboard after short delay
                setTimeout(() => {
                    navigateToPage('dashboard');
                    loadPaywalls();
                }, 1500);
            } catch (error) {
                showErrorMessage('createError', error.message);
            }
        }

        async function loadPaywalls() {
            try {
                // Usage in loadPaywalls
                let data, error;
                ({ data, error } = await api.get(`/account/${currentUser.id}/paywalls`));
                data = data ? data.paywalls : null;

                if (error) throw error;

                displayPaywalls(data || []);
                updateStats(data || []);
            } catch (error) {
                console.error('Error loading paywalls:', error);
                document.getElementById('paywallsTable').innerHTML = '<div class="error">Error loading paywalls</div>';
            }
        }

        function displayPaywalls(paywalls) {
            const tableContainer = document.getElementById('paywallsTable');
            
            if (paywalls.length === 0) {
                tableContainer.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <h3>No paywalls created yet</h3>
                        <p>Create your first paywall to start monetizing your ChatGPT chatbots!</p>
                        <button class="btn" onclick="navigateToPage('create')" style="margin-top: 1rem;">Create Your First Paywall</button>
                    </div>
                `;
                return;
            }

            const tableHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Created Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${paywalls.map(paywall => `
                            <tr>
                                <td>
                                    <strong><a href="#" class="paywall-link" data-paywall-id="${paywall.id}" style="color: #00c896; text-decoration: none;">${paywall.name}</a></strong>
                                    <div style="color: #666; font-size: 0.875rem; margin-top: 0.25rem;">
                                        ${paywall.description && paywall.description.length > 80 ? paywall.description.substring(0, 80) + '...' : (paywall.description || 'No description')}
                                    </div>
                                </td>
                                <td>$${paywall.price}/month</td>
                                <td><span class="status ${paywall.archived ? 'inactive' : 'active'}">${paywall.archived ? 'Inactive' : 'Active'}</span></td>
                                <td>${new Date(paywall.created_at).toLocaleDateString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            tableContainer.innerHTML = tableHTML;
        }

        function updateStats(paywalls) {
            const total = paywalls.length;
            const active = paywalls.filter(p => p.status === 'active').length;
            
            document.getElementById('totalPaywalls').textContent = total;
            document.getElementById('activePaywalls').textContent = active;
        }

        // Paywall Details functions
        async function showPaywallDetails(paywallId) {
            currentPaywallId = paywallId;
            navigateToPage('paywallDetails');
            await loadPaywallDetails(paywallId);
        }

        async function loadPaywallDetails(paywallId) {
            try {
                const { data, error } = await api.get(`/paywall/${paywallId}`);
                
                if (error) throw error;

                displayPaywallDetails(data.paywall);
                await loadPaywallInstructions(paywallId);
            } catch (error) {
                console.error('Error loading paywall details:', error);
                showErrorMessage('paywallDetailsError', 'Error loading paywall details');
            }
        }

        async function loadPaywallInstructions(paywallId) {
            try {
                const { data, error } = await api.get(`/paywall/${paywallId}/instructions`);
                
                if (error) throw error;

                displayPaywallInstructions(data || []);
            } catch (error) {
                console.error('Error loading instructions:', error);
                // Fallback to default instructions if API fails
                displayPaywallInstructions(getDefaultInstructions(paywallId));
            }
        }

        function displayPaywallDetails(paywall) {
            const content = document.getElementById('paywallDetailsContent');
            
            content.innerHTML = `
                <div class="paywall-info">
                    <h3>${paywall.name}</h3>
                    <p style="color: #666; margin-bottom: 1.5rem;">${paywall.description || 'No description provided'}</p>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Status</div>
                            <div class="info-value">
                                <span class="status ${paywall.archived ? 'inactive' : 'active'}">
                                    ${paywall.archived ? 'Inactive' : 'Active'}
                                </span>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Price</div>
                            <div class="info-value">$${paywall.price}/month</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Free Trial</div>
                            <div class="info-value">${paywall.trial || 0} days</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Created</div>
                            <div class="info-value">${new Date(paywall.created_at).toLocaleDateString()}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Currency</div>
                            <div class="info-value">${paywall.currency || 'USD'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Pricing Model</div>
                            <div class="info-value">${paywall.pricing_model || 'Recurring'}</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <div class="info-label">Payment Link</div>
                        <div class="paywall-url">
                            <a href="${paywall.checkout_url}" target="_blank">${paywall.checkout_url}</a>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">0</div>
                            <div class="stat-label">Total Subscribers</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">$0</div>
                            <div class="stat-label">Total Revenue</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">0</div>
                            <div class="stat-label">This Month</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">0%</div>
                            <div class="stat-label">Conversion Rate</div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn" onclick="editPaywall('${paywall.id}')">Edit Paywall</button>
                        <button class="btn btn-warning" onclick="togglePaywallStatus('${paywall.id}', ${paywall.archived})">
                            ${paywall.archived ? 'Activate' : 'Archive'} Paywall
                        </button>
                        <button class="btn btn-secondary" onclick="navigateToPage('dashboard')">Back to Dashboard</button>
                    </div>
                </div>

                <div class="paywall-instructions">
                    <h3 style="color: #00c896; margin-bottom: 2rem; text-align: center;">ChatGPT Integration Instructions</h3>
                    <div id="instructionsContent">
                        <div class="loading">Loading integration instructions...</div>
                    </div>
                </div>
            `;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showSuccessMessage('paywallDetailsSuccess', 'Paywall URL copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showErrorMessage('paywallDetailsError', 'Failed to copy URL');
            });
        }

        async function editPaywall(paywallId) {
            // For now, just show a message. In a full implementation, this would open an edit form
            showSuccessMessage('paywallDetailsSuccess', 'Edit functionality coming soon!');
        }

        async function togglePaywallStatus(paywallId, isArchived) {
            try {
                const action = isArchived ? 'activate' : 'archive';
                const { data, error } = await api.post(`/account/${currentUser.id}/paywall/${paywallId}/${action}`);
                
                if (error) throw error;

                showSuccessMessage('paywallDetailsSuccess', `Paywall ${action}d successfully!`);
                
                // Reload the paywall details
                setTimeout(() => {
                    loadPaywallDetails(paywallId);
                }, 1000);
            } catch (error) {
                console.error('Error toggling paywall status:', error);
                showErrorMessage('paywallDetailsError', 'Error updating paywall status');
            }
        }

        function displayPaywallInstructions(instructions) {
            const content = document.getElementById('instructionsContent');
            
            if (!instructions || instructions.length === 0) {
                content.innerHTML = '<div class="error">No instructions available for this paywall.</div>';
                return;
            }

            const instructionsHTML = [
                getInstructionHTML(1, "Add Paywall Check to ChatGPT Instructions", "Add this code to the beginning of your ChatGPT's custom instructions to check for user subscription before providing responses.", instructions.instructions, "This ensures that only paying subscribers can access your ChatGPT's knowledge and responses."),
                getInstructionHTML(2, "Add GPT Schema", "Add this function to your ChatGPT's system message to verify user subscription status.", instructions.actionSchema, "This provides a more robust verification system for your paywall."),
                getInstructionHTML(3, "Add website with your privacy policy", "OpenAI requires that you have a privacy policy that explains how user data will be handled.", "Your website", "Make sure to highlight the value proposition of your ChatGPT to encourage subscriptions."),

            ].join('');

            content.innerHTML = instructionsHTML;
        }

        function getInstructionHTML(step, name, description, code, note) {
            return `
                <div class="instruction-step">
                    <div class="step-header">
                        <div class="step-number">${step}</div>
                        <h4 class="step-title">${name}</h4>
                    </div>
                    <div class="step-description">${description}</div>
                    ${code ? `
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-label">Code to Copy</span>
                                <button class="code-copy-btn" onclick="copyCodeToClipboard(this, '${code.replace(/'/g, "\\'")}')">
                                    Copy
                                </button>
                            </div>
                            <div class="code-content">${code}</div>
                        </div>
                    ` : ''}
                    ${note ? `
                        <div class="instruction-note">
                            <h4>💡 Pro Tip</h4>
                            <p>${note}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function getDefaultInstructions(paywallId) {
            const paywallUrl = `https://chattifyit.com/paywall/${paywallId}`;
            
            return [
                {
                    name: "Add Paywall Check to ChatGPT Instructions",
                    description: "Add this code to the beginning of your ChatGPT's custom instructions to check for user subscription before providing responses.",
                    code: `IMPORTANT: Before providing any responses, users must first subscribe at ${paywallUrl}. If a user hasn't subscribed, direct them to visit the subscription link first. Only provide responses to subscribed users.`,
                    note: "This ensures that only paying subscribers can access your ChatGPT's knowledge and responses."
                },
                {
                    name: "Create Subscription Verification Function",
                    description: "Add this function to your ChatGPT's system message to verify user subscription status.",
                    code: `// Add this to your ChatGPT's system message
function checkUserSubscription(userId) {
    // This function should verify if the user has an active subscription
    // You can implement this by checking against your paywall system
    return fetch('${paywallUrl}/verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: userId })
    }).then(response => response.json());
}

// Use this before providing any response
const isSubscribed = await checkUserSubscription(userId);
if (!isSubscribed) {
    return "Please subscribe at ${paywallUrl} to access this ChatGPT's responses.";
}`,
                    note: "This provides a more robust verification system for your paywall."
                },
                {
                    name: "Add Subscription Link to Responses",
                    description: "Include the subscription link in your ChatGPT's responses for non-subscribers.",
                    code: `// Add this to your response template for non-subscribers
"To access this ChatGPT's full capabilities, please subscribe at: ${paywallUrl}

Your subscription gives you unlimited access to specialized knowledge and responses that can save you hours of research and work."`,
                    note: "Make sure to highlight the value proposition of your ChatGPT to encourage subscriptions."
                },
                {
                    name: "Test Your Integration",
                    description: "Follow these steps to ensure your paywall integration is working correctly.",
                    code: `1. Open your ChatGPT in a private/incognito browser window
2. Try to use the chatbot without subscribing first
3. Verify it directs you to the subscription page
4. Complete a test subscription
5. Verify you can now access the full ChatGPT responses
6. Test the subscription verification is working properly`,
                    note: "Always test your integration thoroughly before promoting your paywall to ensure a smooth user experience."
                }
            ];
        }

        function copyCodeToClipboard(button, code) {
            // Decode the escaped quotes
            const decodedCode = code.replace(/\\'/g, "'");
            
            navigator.clipboard.writeText(decodedCode).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy code: ', err);
                button.textContent = 'Failed';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }

        // Navigation functions
        function navigateToPage(page) {
            // Update sidebar navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Only update sidebar if it's not a special page like paywallDetails
            if (page !== 'paywallDetails') {
                const navItem = document.querySelector(`[data-page="${page}"]`);
                if (navItem) {
                    navItem.classList.add('active');
                }
            }

            // Show the selected page
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById(`${page}Page`).classList.add('active');

            // Load data if necessary
            if (page === 'dashboard') {
                loadPaywalls();
            }

            currentPage = page;
        }

        // UI helper functions
        function showApp() {
            landingPage.style.display = 'none';
            appLayout.classList.add('active');
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('getStartedBtn').classList.add('hidden');
            document.getElementById('logoutBtn').classList.remove('hidden');
        }

        function showLanding() {
            landingPage.style.display = 'block';
            appLayout.classList.remove('active');
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('getStartedBtn').classList.remove('hidden');
            document.getElementById('logoutBtn').classList.add('hidden');
        }

        function showLoginForm() {
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginToggle').classList.remove('hidden');
            document.querySelector('.signup-form h3').textContent = 'Welcome Back';
        }

        function showSignupForm() {
            document.getElementById('signupForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('loginToggle').classList.add('hidden');
            document.querySelector('.signup-form h3').textContent = 'Get Started Today';
        }

        function showError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            
            // Hide success message if visible
            document.getElementById('authSuccess').classList.add('hidden');
        }

        function showSuccess(message) {
            const successEl = document.getElementById('authSuccess');
            successEl.textContent = message;
            successEl.classList.remove('hidden');
            
            // Hide error message if visible
            document.getElementById('authError').classList.add('hidden');
        }

        function showErrorMessage(elementId, message) {
            const errorEl = document.getElementById(elementId);
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            
            // Hide corresponding success message
            const successId = elementId.replace('Error', 'Success');
            const successEl = document.getElementById(successId);
            if (successEl) successEl.classList.add('hidden');
        }

        function showSuccessMessage(elementId, message) {
            const successEl = document.getElementById(elementId);
            successEl.textContent = message;
            successEl.classList.remove('hidden');
            
            // Hide corresponding error message
            const errorId = elementId.replace('Success', 'Error');
            const errorEl = document.getElementById(errorId);
            if (errorEl) errorEl.classList.add('hidden');
        }

        // Listen for auth state changes
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                showApp();
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                showLanding();
            }
        });
    </script>
</body>
</html>
